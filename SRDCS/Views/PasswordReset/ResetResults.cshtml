<!-- Views/PasswordReset/ResetResults.cshtml -->
@model List<SRDCS.Controllers.PasswordResetResult>
@{
    ViewData["Title"] = "Password Reset Results";
    Layout = "_AuthLayout";
}

<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card shadow">
            <div class="card-header bg-success text-white">
                <h3 class="text-center mb-0">
                    <i class="fas fa-check-circle me-2"></i>Password Reset Complete
                </h3>
            </div>
            <div class="card-body p-4">
                @if (TempData["SuccessMessage"] != null)
                {
                    <div class="alert alert-success">
                        <i class="fas fa-check me-2"></i>@TempData["SuccessMessage"]
                    </div>
                }

                <div class="alert alert-info">
                    <h5><i class="fas fa-clipboard-list me-2"></i>New Login Credentials</h5>
                    <p>Please copy and distribute these credentials to the respective users:</p>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Username</th>
                                <th>User Type</th>
                                <th>New Password</th>
                                <th>Old Hash (Preview)</th>
                                <th>New Hash (Preview)</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var result in Model)
                            {
                                <tr>
                                    <td>
                                        <strong>@result.Username</strong>
                                        @if (result.Username == "admin")
                                        {
                                            <span class="badge bg-danger ms-2">System Admin</span>
                                        }
                                    </td>
                                    <td>
                                        <span class="badge bg-primary">@result.UserType?.Replace("_", " ")</span>
                                    </td>
                                    <td>
                                        <code class="text-success">@result.NewPassword</code>
                                        <button class="btn btn-sm btn-outline-secondary ms-2"
                                                onclick="copyToClipboard('@result.NewPassword')"
                                                title="Copy password">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </td>
                                    <td>
                                        <small class="text-muted">@result.OldHashPreview</small>
                                    </td>
                                    <td>
                                        <small class="text-success">@result.NewHashPreview</small>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>

                <div class="alert alert-warning mt-3">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Important Notes</h5>
                    <ol class="mb-0">
                        <li>All passwords have been reset to the values shown above</li>
                        <li>Users should change their passwords after first login</li>
                        <li>Keep this information secure until distributed to users</li>
                        <li>Consider enabling password change enforcement in user settings</li>
                    </ol>
                </div>

                <div class="d-flex justify-content-between mt-4">
                    <a asp-action="Index" class="btn btn-secondary">
                        <i class="fas fa-redo me-2"></i>Reset More Passwords
                    </a>
                    <div>
                        <a href="/view-users" class="btn btn-outline-info me-2">
                            <i class="fas fa-users me-2"></i>View All Users
                        </a>
                        <a href="/Account/Login" class="btn btn-primary">
                            <i class="fas fa-sign-in-alt me-2"></i>Go to Login
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(function() {
                alert('Password copied to clipboard: ' + text);
            }, function(err) {
                console.error('Could not copy text: ', err);
            });
        }

        // Auto-redirect to login after 30 seconds
        setTimeout(function() {
            window.location.href = '/Account/Login';
        }, 30000);
    </script>

    <style>
        .table th {
            background-color: #2c3e50;
            color: white;
        }

        code {
            padding: 2px 6px;
            background: #f8f9fa;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
    </style>
}